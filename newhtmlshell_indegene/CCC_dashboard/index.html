<%@page import="com.medschool.common.ProfileTier"%>
<%@page import="com.medschool.common.Profile"%>
<%@page import="com.medschool.common.ProfileManager"%>
<%@page import="com.medschool.common.ClientManager"%>
<%@page import="com.medschool.common.Client"%>
<%@page import="com.medschool.common.Tier"%>
<%@page import="java.util.*"%>
<%
	response.setHeader("Cache-Control","no-cache"); //HTTP 1.1
	response.setHeader("Pragma", "no-cache"); //HTTP 1.0
	response.setDateHeader("Expires", 0); //prevents caching at proxy
	final String CLIENT_NAME="CCC";
	Client client=ClientManager.getInstance().getClient(CLIENT_NAME);
	if(client == null){
		response.sendError(response.SC_INTERNAL_SERVER_ERROR, "Client Not Found");
		return;
	}
	ProfileManager pm = ProfileManager.getInstance(client.getClientID());
	//List users = pm.getProfiles("getValidFrom", 1);
	//System.out.println(" User size is : "+users.size());
	String fname = "",lname = "",login = "";
	
	if(request.getParameter("login") != null && request.getParameter("firstname") != null){
		login = request.getParameter("login");
		fname = request.getParameter("firstname");
		lname = request.getParameter("lastname");
	}
	Profile profile = null;
	if(login.length() >1 && client != null){
		profile = pm.getProfile(login);
		if(profile == null){
			profile = pm.login(request, true);
			profile.setFirstName(fname);
			profile.setLastName(lname);
			pm.updateProfile(profile);
			Tier tier = Tier.get(client.getClientID(), "All user");
			ProfileTier pt = new ProfileTier(client.getClientID(), profile.getLoginID(), tier.getID());
			pt.map();
		//ProfileManager.getInstance(client.getClientID());
		}else profile = pm.login(request, true);
		if (profile != null ) { 
			response.sendRedirect("services.jsp");
		    return;
        }
	}
	
	if(request.getParameter("logoff") != null){
		session.invalidate();
	}
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Corporate Call center Inc.</title>
<meta http-equiv="X-UA-Compatible" content="IE=8">
<link rel="stylesheet" href="styles/style.css">
<script>
function submitOnClick(formName){ 

	var chars = /^[a-zA-Z0-9@._ ]*$/;
	
	
	if(document.theform.firstname.value.trim() ==""){ 
		alert("Please enter your first name"); 
		return false; 
	}
	
	if(!chars.test(document.theform.firstname.value)){
		alert("Please enter a valid first name (Characters, numbers and special characters (@ _ . only) are accepted)" ); 
		return false; 
	}
	
	if(document.theform.lastname.value.trim() ==""){ 
		alert("Please enter your last name"); 
		return false; 
	}
	
	if(!chars.test(document.theform.lastname.value)){
		alert("Please enter a valid last name (Characters, numbers and special characters (@ _ . only) are accepted)" ); 
		return false; 
	}
	
	if(document.theform.login.value.trim() == ""){ 
		alert("Please enter your User ID"); 
		return false; 
	}
	
	if(!chars.test(document.theform.login.value)){
		alert("Please enter a valid User ID (Characters, numbers and special characters (@ _ . only) are accepted)" ); 
		return false; 
	}else{
		document.forms[formName].submit(); 
	}
}

if(typeof String.prototype.trim !== 'function') {
  String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, ''); 
  };
}
</script>
</head>

<body>
<div id="wrapper">
	<div id="headbox">
		
    </div>
    <div id="footbox">
    	<div class="right_sec">
            <div class="logo_down">
                <img src="images/logo_down.png" alt="" title="" />
            </div>
            <div class="contact">
                Corporate Call Center drives brand loyalty through operational excellence. Our commitment is to make our partners more profitable through the use of multi-channel communication. We are the vital link driving sales, quality and efficiency for our clients' brand.<br /><br /><span style="color:#666;">The portal and modules in the dashboard work best in Internet Explorer 8 for PC/laptop.</span>
            </div>
        </div>
        <div class="seperator"></div>
        <div class="loginsec">
            
            <form name="theform" id="theform" action="index.jsp" method="post" onsubmit="return submitOnClick('theform')" >
            	<table align="center" cellpadding="0" cellspacing="0">
                	<tr>
                    	<td>&nbsp;</td>
                    	<td>
                            <div class="heading">
                                <img src="images/login.png" />
                                <h2 style="text-align:left;">User Login</h2>
                            </div>
                        </td>
                    </tr>
                	<tr>
                    	<td width="200"><span>First Name:</span></td>
                    	<td><input type="text" name="firstname" placeholder="First Name" class="user" id="user" maxlength="20"/></td>
                    </tr>
                	<tr>
                    	<td style="width:120px; margin-right:20px"><span>Last Name:</span></td>
                    	<td><input type="text" name="lastname" placeholder="Last Name" class="user" id="user" maxlength="20"/></td>
                    </tr>
                	<tr>
                    	<td><span>User ID:</span></td>
                    	<td><input type="text" name="login" placeholder="User ID" class="pass" id="pass" maxlength="50"/></td>
                    </tr>
                	<tr>
                    	<td>&nbsp;</td>
                    	<td><input type="submit" value="Login" class="submit" /></td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
    <div class="footer">
        <div class="policy">
            <p>Powered by Indegene
            <span><a href="http://www.indegene.com/" target="_blank"><img src="images/ind_logo.png" title="" alt="" /></a></span></p>
        </div>
        <div class="copyright">&copy;2014 Corporate Call Center, Inc.- All Rights Reserved.</div>
    </div>
</div>
</body>
</html>